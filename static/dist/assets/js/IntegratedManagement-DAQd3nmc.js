import{d as Ke,r as i,p as zl,m as He,S as Fl,G as U,H as a,ag as C,o as p,P as l,u as Dl,a as B,L as r,n as De,X as ee,c as k,I as he,aq as El,M as E,J as ie,O as le,a6 as te,a4 as Le,V as Je}from"./vue-core-grCPbCnX.js";import{_ as We,u as pe,p as j,a as Pe,r as G}from"./index-17SbRRaG.js";import{u as ql,i as Ol,f as Tl,b as jl,c as Bl,d as Nl,E as Al}from"./echarts-ECTwgUBz.js";import{E as n,f as ce}from"./element-plus-DCTHCecp.js";const Ml={class:"card-header"},Ll=Ke({__name:"NetworkGraph",props:{inboundProxies:{},outboundProxies:{},userGroups:{},routeSchemes:{}},setup(Ee){ql([Ol,Tl,jl,Bl,Nl]);const f=Ee,ae=i({title:{top:0,left:"center"},tooltip:{trigger:"item",formatter:v=>{if(v.dataType==="node")return`${v.data.name}`;if(v.dataType==="edge")return v.data.info?`${v.data.info}`:`${v.data.source} -> ${v.data.target}`}},legend:{data:[{name:"入站代理",icon:"circle",itemStyle:{color:"#4CAF50"}},{name:"用户组",icon:"circle",itemStyle:{color:"#2196F3"}},{name:"路由方案",icon:"circle",itemStyle:{color:"#FF9800"}},{name:"出站代理",icon:"circle",itemStyle:{color:"#9C27B0"}}]},animationDurationUpdate:150,animationEasingUpdate:"quinticInOut",series:[{type:"graph",layout:"none",data:[],links:[],categories:[{name:"入站代理",itemStyle:{color:"#4CAF50"}},{name:"用户组",itemStyle:{color:"#2196F3"}},{name:"路由方案",itemStyle:{color:"#FF9800"}},{name:"出站代理",itemStyle:{color:"#9C27B0"}}],label:{show:!0,position:"bottom",formatter:"{b}",backgroundColor:"transparent",borderWidth:0,color:"#333",fontSize:12,distance:10},lineStyle:{color:"#999",width:2,curveness:.1},emphasis:{focus:"adjacency",lineStyle:{width:4}}}]});zl([()=>f.inboundProxies,()=>f.outboundProxies,()=>f.userGroups,()=>f.routeSchemes],()=>{De(()=>{V()})},{deep:!0});const V=()=>{console.log("Generating graph data with:",{inboundProxies:f.inboundProxies,userGroups:f.userGroups,routeSchemes:f.routeSchemes,outboundProxies:f.outboundProxies});const v=[],x=[];let R=parseInt(getComputedStyle(document.querySelector(".chart")).width),z=550*parseInt(getComputedStyle(document.querySelector(".chart")).height)/R,q=Math.max(f.inboundProxies.length,f.outboundProxies.length,f.userGroups.length,f.routeSchemes.length),oe=z/(q-1);console.log("max_node_count:",q);const ne=m=>{if(m<=1)return[z/2];const w=[];let P=oe*(m-1),O=z/2-P/2;for(let M=0;M<m;M++)w.push(O+oe*M);return w},N=ne(f.inboundProxies.length);f.inboundProxies.forEach((m,w)=>{v.push({id:`inbound-${m.id}`,name:m.id,symbolSize:40,category:0,value:m.enabled?1:0,itemStyle:{color:m.enabled?"#4CAF50":"#BDBDBD"},x:100,y:N[w],fixed:!0})});const A=ne(f.userGroups.length);f.userGroups.forEach((m,w)=>{const P=`group-${m.id}`;v.push({id:P,name:m.id,symbolSize:40,category:1,itemStyle:{color:"#2196F3"},x:300,y:A[w],fixed:!0}),m.inboundProxyIds.forEach(O=>{x.push({source:`inbound-${O}`,target:P,value:1})})});const me=ne(f.routeSchemes.length);f.routeSchemes.forEach((m,w)=>{var O;const P=`scheme-${m.id}`;v.push({id:P,name:m.id,symbolSize:40,category:2,itemStyle:{color:m.enabled?"#FF9800":"#BDBDBD"},x:500,y:me[w],fixed:!0}),(O=m.rules)==null||O.forEach(M=>{M.outbounds.forEach(J=>{x.push({source:P,info:"rule: "+M.priority+" - "+M.name,target:`outbound-${J}`,value:1})})})});const fe=ne(f.outboundProxies.length);f.outboundProxies.forEach((m,w)=>{v.push({id:`outbound-${m.id}`,name:m.id,symbolSize:40,category:3,value:m.enabled?1:0,itemStyle:{color:"#9C27B0"},x:700,y:fe[w],fixed:!0})}),f.userGroups.forEach(m=>{const w=`scheme-${m.routeSchemeId}`;x.push({source:`group-${m.id}`,target:w,value:1})}),console.log("Generated nodes:",v),console.log("Generated links:",x),ae.value.series[0].data=v,ae.value.series[0].links=x},_e=()=>{V()},Y=()=>{console.log("Window resized, regenerating graph..."),V()};return He(()=>{window.addEventListener("resize",Y),V()}),Fl(()=>{window.removeEventListener("resize",Y)}),(v,x)=>{const R=C("el-button"),y=C("el-card");return p(),U(y,{shadow:"never",class:"network-graph"},{header:a(()=>[B("div",Ml,[x[1]||(x[1]=B("span",null,"路由拓扑图",-1)),l(R,{type:"primary",onClick:_e},{default:a(()=>x[0]||(x[0]=[r("刷新")])),_:1})])]),default:a(()=>[l(Dl(Al),{class:"chart",option:ae.value,autoresize:""},null,8,["option"])]),_:1})}}}),Jl=We(Ll,[["__scopeId","data-v-ec3d4b10"]]),Kl={class:"integrated-management"},Hl={key:0},Wl={key:1,class:"network-graph-container"},Yl={class:"main-tabs-container"},Ql={key:0},Xl={key:0},Zl={key:0},et={key:1},lt={class:"dialog-footer"},tt={key:1},at={class:"dialog-footer"},ot={class:"dialog-footer"},nt={class:"dialog-footer"},st={class:"rules-header"},rt={class:"dialog-footer"},dt={key:0},ut={key:0,class:"qrcode-container"},it={key:1},pt={class:"dialog-footer"},ct=Ke({__name:"IntegratedManagement",setup(Ee){const f=i("inbound"),ae=i("users"),V=ee({users:!0,inbound:!0,outbound:!0,groups:!0,routes:!0}),_e=i([]),Y=i([]),v=i([]),x=i([]),R=i([]),y=i(null),z=i(!1),q=i("add"),oe=i(),ne=i(null),N=i(!1),A=i("add"),me=i(),fe=i(null),m=i("json"),w=i(!1),P=i("add"),O=i(),M=i(null),J=i(!1),be=i("add"),Ie=i(),ke=i(null),$e=i(!1),se=i(!1),Ce=i("add"),Ge=i(),xe=i(null),Re=i(!1),Q=i(""),ye=i(!1),L=ee({id:"",description:""}),S=ee({id:"",email:"",userGroupId:"",password:"",enabled:!0}),g=ee({id:"",config:""}),$=ee({id:"",inboundProxyIds:[],routeSchemeId:""}),T=ee({id:"",description:"",enabled:!0}),h=ee({name:"",type:"domain",pattern:"",priority:0,outbounds:[],enabled:!0}),Ye={id:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],userGroupId:[{required:!0,message:"请选择用户组",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],enabled:[{required:!0,message:"请选择状态",trigger:"change"}]},Qe={id:[{required:!0,message:"请输入代理名称",trigger:"blur"}],config:[{required:!0,message:"请输入配置",trigger:"blur"}]},Xe={id:[{required:!0,message:"请输入用户组名称",trigger:"blur"}],inboundProxyIds:[{required:!0,message:"请选择入站代理",trigger:"change"}],routeSchemeId:[{required:!0,message:"请选择路由方案",trigger:"change"}]},qe={id:[{required:!0,message:"请输入方案名称",trigger:"blur"}],description:[{required:!0,message:"请输入描述",trigger:"blur"}]},Ze={name:[{required:!0,message:"请输入规则名称",trigger:"blur"}],type:[{required:!0,message:"请选择目的类型",trigger:"change"}],pattern:[{required:!0,message:"请输入匹配模式",trigger:"blur"}],outbounds:[{required:!0,message:"请选择出站代理",trigger:"change"}]};He(async()=>{await Promise.all([ge(),ve(),Se(),Ue(),K()])});const ge=async()=>{try{_e.value=await pe.getUsers()}catch(o){n.error("获取用户列表失败"),console.error(o)}finally{V.users=!1}},ve=async()=>{try{Y.value=await j.getInboundProxies()}catch(o){n.error("获取入站代理列表失败"),console.error(o)}finally{V.inbound=!1}},Se=async()=>{try{v.value=await j.getOutboundProxies()}catch(o){n.error("获取出站代理列表失败"),console.error(o)}finally{V.outbound=!1}},Ue=async()=>{try{x.value=await Pe.getUserGroups()}catch(o){n.error("获取用户组列表失败"),console.error(o)}finally{V.groups=!1}},K=async()=>{try{R.value=await G.getRouteSchemes()}catch(o){n.error("获取路由方案列表失败"),console.error(o)}finally{V.routes=!1}},el=()=>{q.value="add",Object.assign(S,{id:"",email:"",userGroupId:"",password:"",enabled:!0}),z.value=!0},ll=o=>{q.value="edit",ne.value=o,Object.assign(S,{id:o.id,email:o.email,userGroupId:o.userGroupId,enabled:o.enabled}),z.value=!0},tl=async o=>{try{o.enabled=!o.enabled,await pe.updateUser(o.id,o)?(n.success("状态更新成功"),await ge()):n.error("状态更新失败")}catch(e){n.error("状态更新失败"),console.error(e)}},al=async o=>{try{await ce.confirm("确定要重置该用户的密码吗？","提示",{type:"warning"}),await pe.resetPassword(o.id)?n.success("密码重置为用户名"):n.error("密码重置失败")}catch{}},ol=async o=>{try{await ce.confirm("确定要删除该用户吗？","提示",{type:"warning"}),await pe.deleteUser(o.id)?(n.success("删除成功"),await ge()):n.error("删除失败")}catch{}},nl=async()=>{oe.value&&await oe.value.validate(async o=>{if(o)try{q.value==="add"?await pe.createUser(S)?(n.success("添加成功"),z.value=!1,await ge()):n.error("添加失败"):await pe.updateUser(S.id,S)?(n.success("更新成功"),z.value=!1,await ge()):n.error("更新失败")}catch(e){n.error(q.value==="add"?"添加失败":"更新失败"),console.error(e)}})},Oe=o=>{A.value="add",Object.assign(g,{id:"",config:""}),N.value=!0},Te=(o,e)=>{A.value="edit",fe.value=o,Object.assign(g,{id:o.id,config:typeof o.config=="string"?o.config:JSON.stringify(o.config,null,2)}),N.value=!0},sl=async(o,e)=>{try{let d;e==="inbound"&&(d=await j.updateInboundProxy(o.id,o)),d?(n.success("状态更新成功"),e==="inbound"&&await ve()):(o.enabled=!o.enabled,n.error("状态更新失败"))}catch(d){o.enabled=!o.enabled,n.error("状态更新失败"),console.error(d)}},je=async(o,e)=>{try{await ce.confirm("确定要删除该代理吗？","提示",{type:"warning"});let d;e==="inbound"?d=await j.deleteInboundProxy(o.id):d=await j.deleteOutboundProxy(o.id),d?(n.success("删除成功"),e==="inbound"?await ve():await Se()):n.error("删除失败")}catch{}},rl=async o=>{try{o.testing=!0;const e=await j.testOutboundProxySpeed(o.id);o.latency=e.latency,n.success(`延迟测试完成：${e.latency}`)}catch(e){n.error("延迟测试失败"),console.error(e)}finally{o.testing=!1}},dl=async o=>{try{Q.value=o.linkConfig||"",Re.value=!0}catch(e){n.error("获取连接配置失败"),console.error(e)}},ul=()=>{navigator.clipboard.writeText(Q.value),n.success("连接配置已复制到剪贴板")},il=o=>`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(o)}`,pl=async()=>{me.value&&await me.value.validate(async o=>{var e,d;if(o)try{JSON.parse(g.config);let s=g.config;if(A.value==="add"){let b;f.value==="inbound"?b=await j.createInboundProxy({id:g.id,enabled:!0,config:s}):b=await j.createOutboundProxy({id:g.id,enabled:!0,config:s}),b?(n.success("添加成功"),N.value=!1,await Promise.all([ve(),Se()])):n.error("添加失败")}else{let b;f.value==="inbound"?b=await j.updateInboundProxy(g.id,{enabled:(e=fe.value)==null?void 0:e.enabled,config:s}):b=await j.updateOutboundProxy(g.id,{enabled:(d=fe.value)==null?void 0:d.enabled,config:s}),b?(n.success("更新成功"),N.value=!1,await Promise.all([ve(),Se()])):n.error("更新失败")}}catch(s){n.error("配置格式错误"),console.error(s)}})},cl=()=>{P.value="add",Object.assign($,{id:"",inboundProxyIds:[],routeSchemeId:""}),w.value=!0},ml=o=>{P.value="edit",M.value=o,Object.assign($,{id:o.id,inboundProxyIds:o.inboundProxyIds,routeSchemeId:o.routeSchemeId}),w.value=!0},fl=async o=>{try{await ce.confirm("确定要删除该用户组吗？","提示",{type:"warning"}),await Pe.deleteUserGroup(o.id)?(n.success("删除成功"),await Ue()):n.error("删除失败")}catch{}},bl=async()=>{O.value&&await O.value.validate(async o=>{if(o)try{P.value==="add"?await Pe.createUserGroup($)?(n.success("添加成功"),w.value=!1,await Ue()):n.error("添加失败"):await Pe.updateUserGroup($.id,$)?(n.success("更新成功"),w.value=!1,await Ue()):n.error("更新失败")}catch(e){n.error(P.value==="add"?"添加失败":"更新失败"),console.error(e)}})},yl=()=>{be.value="add",Object.assign(T,{id:"",description:"",enabled:!0}),J.value=!0},gl=o=>{be.value="edit",ke.value=o,Object.assign(T,{id:o.id,description:o.description,enabled:o.enabled}),J.value=!0},vl=o=>{ke.value=o,L.id=`${o.id} 副本`,L.description=`${o.description||""} (复制于 ${o.id})`,ye.value=!0},wl=async()=>{if(ke.value)try{const o=await G.createRouteScheme({id:L.id,description:L.description,enabled:!1}),e=await G.getRules(ke.value.id);if(e&&e.length>0)for(const d of e)await G.addRule(o.id,{name:d.name,type:d.type,pattern:d.pattern,priority:d.priority||0,outbounds:d.outbounds,enabled:d.enabled||!0});n.success("复制方案成功"),ye.value=!1,await K()}catch(o){console.error("复制方案失败",o),n.error("复制方案失败")}},Vl=async o=>{try{await ce.confirm("确定要删除该路由方案吗？","提示",{type:"warning"}),await G.deleteRouteScheme(o.id),n.success("删除成功"),await K()}catch(e){console.error("删除路由方案失败",e),n.error("删除路由方案失败")}},hl=async o=>{try{await G.updateRouteScheme(o.id,{enabled:o.enabled}),n.success("更新成功"),await K()}catch(e){o.enabled=!o.enabled,console.error("更新路由方案状态失败",e),n.error("更新路由方案状态失败")}},_l=async()=>{Ie.value&&await Ie.value.validate(async o=>{if(o)try{be.value==="add"?(await G.createRouteScheme(T),n.success("添加成功")):(await G.updateRouteScheme(T.id,T),n.success("更新成功")),J.value=!1,await K()}catch(e){console.error("保存路由方案失败",e),n.error("保存路由方案失败")}})},kl=o=>{y.value=o,$e.value=!0},Cl=()=>{Ce.value="add",Object.assign(h,{name:"",type:"domain",pattern:"",priority:0,outbounds:[],enabled:!0}),se.value=!0},xl=o=>{Ce.value="edit",xe.value=o,Object.assign(h,{name:o.name,type:o.type,pattern:o.pattern,priority:o.priority,outbounds:o.outbounds,enabled:o.enabled}),se.value=!0},Sl=async o=>{try{if(await ce.confirm("确定要删除该规则吗？","提示",{type:"warning"}),!y.value)return;await G.deleteRule(y.value.id,o.id),n.success("删除成功"),await K(),y.value=R.value.find(e=>{var d;return e.id===((d=y.value)==null?void 0:d.id)})||null}catch(e){console.error("删除规则失败",e),n.error("删除规则失败")}},Be=async(o,e)=>{if(!y.value)return;const d=y.value.rules,s=d.findIndex(b=>b.id===o.id);e==="up"&&s>0?[d[s],d[s-1]]=[d[s-1],d[s]]:e==="down"&&s<d.length-1&&([d[s],d[s+1]]=[d[s+1],d[s]]);try{const b=d.map(F=>F.id);await G.updateRuleOrder(y.value.id,b),n.success("规则顺序更新成功"),await K(),y.value=R.value.find(F=>{var u;return F.id===((u=y.value)==null?void 0:u.id)})||null}catch(b){console.error("更新规则顺序失败",b),n.error("更新规则顺序失败")}},Ul=async()=>{!Ge.value||!y.value||await Ge.value.validate(async o=>{if(o)try{Ce.value==="add"?(await G.addRule(y.value.id,h),n.success("添加成功")):xe.value&&(await G.updateRule(y.value.id,xe.value.id,{id:xe.value.id,name:h.name,type:h.type,pattern:h.pattern,priority:h.priority,outbounds:h.outbounds,enabled:h.enabled}),n.success("更新成功")),se.value=!1,await K(),y.value=R.value.find(e=>{var d;return e.id===((d=y.value)==null?void 0:d.id)})||null}catch(e){console.error("保存规则失败",e),n.error("保存规则失败")}})},Ne=o=>x.value.filter(e=>e.routeSchemeId===o),Pl=o=>({domain:"success",ip:"warning",geosite:"info",any:"danger"})[o]||"info",Il=o=>({domain:"域名",ip:"IP",geosite:"Geosite",any:"任何"})[o]||o,$l=o=>{const e=o.target,d=e.selectionStart,s=e.selectionEnd;g.config=g.config.substring(0,d)+"    "+g.config.substring(s),De(()=>{e.selectionStart=e.selectionEnd=d+4})},Gl=o=>{const e=o.target,d=e.selectionStart;e.selectionEnd;const b=g.config.substring(0,d).split(`
`),F=d-b[b.length-1].length;g.config.substring(F,d).match(/^    /)&&(g.config=g.config.substring(0,F)+g.config.substring(d),De(()=>{e.selectionStart=e.selectionEnd=F}))};return(o,e)=>{var Ae;const d=C("el-empty"),s=C("el-table-column"),b=C("el-tag"),F=C("el-switch"),u=C("el-button"),re=C("el-button-group"),de=C("el-table"),X=C("el-tab-pane"),ze=C("el-tabs"),I=C("el-input"),_=C("el-form-item"),H=C("el-option"),we=C("el-select"),ue=C("el-form"),W=C("el-dialog"),Rl=C("el-image"),Ve=El("loading");return p(),k("div",Kl,[!V.routes&&!V.groups&&!V.inbound&&!V.outbound?(p(),k("div",Hl,[l(Jl,{"inbound-proxies":Y.value,"outbound-proxies":v.value,"user-groups":x.value,"route-schemes":R.value},null,8,["inbound-proxies","outbound-proxies","user-groups","route-schemes"])])):(p(),k("div",Wl,[l(d,{description:"数据加载中，请稍候..."})])),B("div",Yl,[l(ze,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=t=>f.value=t),class:"management-tabs"},{default:a(()=>[l(X,{label:"入站代理",name:"inbound"},{default:a(()=>[he((p(),U(de,{data:Y.value,style:{width:"100%"}},{default:a(()=>[l(s,{prop:"id",label:"代理名称"}),l(s,{prop:"scheme",label:"代理类型"}),l(s,{prop:"running",label:"运行状态"},{default:a(({row:t})=>[l(b,{type:t.running?"success":"danger"},{default:a(()=>[r(E(t.running?"运行中":"已停止"),1)]),_:2},1032,["type"])]),_:1}),l(s,{prop:"enabled",label:"启用"},{default:a(({row:t})=>[l(F,{modelValue:t.enabled,"onUpdate:modelValue":c=>t.enabled=c,onChange:c=>sl(t,"inbound")},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(s,{label:"操作",width:"300"},{header:a(()=>[l(u,{type:"primary",onClick:e[0]||(e[0]=t=>Oe("inbound")),style:{width:"70%"}},{default:a(()=>e[38]||(e[38]=[r(" 添加入站代理 ")])),_:1})]),default:a(({row:t})=>[l(re,null,{default:a(()=>[l(u,{size:"small",type:"success",onClick:c=>dl(t)},{default:a(()=>e[39]||(e[39]=[r(" 获取连接配置 ")])),_:2},1032,["onClick"]),l(u,{size:"small",type:"primary",onClick:c=>Te(t,"inbound")},{default:a(()=>e[40]||(e[40]=[r(" 编辑 ")])),_:2},1032,["onClick"]),l(u,{size:"small",type:"danger",onClick:c=>je(t,"inbound")},{default:a(()=>e[41]||(e[41]=[r(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ve,V.inbound]])]),_:1}),l(X,{label:"用户管理",name:"user_manage"},{default:a(()=>[l(ze,{modelValue:ae.value,"onUpdate:modelValue":e[1]||(e[1]=t=>ae.value=t)},{default:a(()=>[l(X,{label:"用户",name:"users"},{default:a(()=>[he((p(),U(de,{data:_e.value,style:{width:"100%"}},{default:a(()=>[l(s,{prop:"id",label:"用户名"}),l(s,{prop:"email",label:"邮箱"}),l(s,{prop:"userGroupId",label:"用户组"}),l(s,{prop:"enabled",label:"状态"},{default:a(({row:t})=>[l(b,{type:t.enabled?"success":"danger"},{default:a(()=>[r(E(t.enabled?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(s,{label:"操作",width:"300"},{header:a(()=>[l(u,{type:"primary",onClick:el,style:{width:"75%"}},{default:a(()=>e[42]||(e[42]=[r(" 添加用户 ")])),_:1})]),default:a(({row:t})=>[l(re,null,{default:a(()=>[l(u,{size:"small",type:t.enabled?"danger":"success",onClick:c=>tl(t)},{default:a(()=>[r(E(t.enabled?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),l(u,{size:"small",type:"primary",onClick:c=>ll(t)},{default:a(()=>e[43]||(e[43]=[r(" 编辑 ")])),_:2},1032,["onClick"]),l(u,{size:"small",type:"warning",onClick:c=>al(t)},{default:a(()=>e[44]||(e[44]=[r(" 重置密码 ")])),_:2},1032,["onClick"]),l(u,{size:"small",type:"danger",onClick:c=>ol(t)},{default:a(()=>e[45]||(e[45]=[r(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ve,V.users]])]),_:1}),l(X,{label:"用户组",name:"groups"},{default:a(()=>[he((p(),U(de,{data:x.value,style:{width:"100%"}},{default:a(()=>[l(s,{prop:"id",label:"名称"}),l(s,{label:"关联入站代理"},{default:a(({row:t})=>[(p(!0),k(le,null,te(t.inboundProxyIds,c=>(p(),U(b,{key:c,class:"mx-1",type:"success",style:{"margin-right":"4px"}},{default:a(()=>[r(E(c),1)]),_:2},1024))),128)),!t.inboundProxyIds||t.inboundProxyIds.length===0?(p(),k("span",Ql,"无")):ie("",!0)]),_:1}),l(s,{label:"路由方案"},{default:a(({row:t})=>[l(b,{type:"info"},{default:a(()=>[r(E(t.routeSchemeId),1)]),_:2},1024)]),_:1}),l(s,{label:"用户数"},{default:a(({row:t})=>[l(b,{type:"warning"},{default:a(()=>[r(E(t.userCount||0)+"人",1)]),_:2},1024)]),_:1}),l(s,{label:"操作",width:"200"},{header:a(()=>[l(u,{type:"primary",onClick:cl},{default:a(()=>e[46]||(e[46]=[r("添加用户组")])),_:1})]),default:a(({row:t})=>[l(re,null,{default:a(()=>[l(u,{size:"small",onClick:c=>ml(t)},{default:a(()=>e[47]||(e[47]=[r("编辑")])),_:2},1032,["onClick"]),l(u,{size:"small",type:"danger",onClick:c=>fl(t)},{default:a(()=>e[48]||(e[48]=[r("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ve,V.groups]])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(X,{label:"路由管理",name:"routes"},{default:a(()=>[he((p(),U(de,{data:R.value,style:{width:"100%"}},{default:a(()=>[l(s,{prop:"id",label:"方案名称"}),l(s,{prop:"description",label:"描述"}),l(s,{prop:"enabled",label:"状态"},{default:a(({row:t})=>[l(F,{modelValue:t.enabled,"onUpdate:modelValue":c=>t.enabled=c,onChange:c=>hl(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(s,{label:"关联用户组"},{default:a(({row:t})=>[(p(!0),k(le,null,te(Ne(t.id),c=>(p(),U(b,{key:c.id,class:"mx-1",style:{"margin-right":"4px"}},{default:a(()=>[r(E(c.id)+" ("+E(c.userCount||0)+") ",1)]),_:2},1024))),128)),Ne(t.id).length===0?(p(),k("span",Xl,"无")):ie("",!0)]),_:1}),l(s,{label:"操作",width:"300"},{header:a(()=>[l(u,{type:"primary",onClick:yl,style:{width:"75%"}},{default:a(()=>e[49]||(e[49]=[r(" 添加路由方案 ")])),_:1})]),default:a(({row:t})=>[l(re,null,{default:a(()=>[l(u,{size:"small",type:"primary",onClick:c=>kl(t)},{default:a(()=>e[50]||(e[50]=[r(" 查看规则 ")])),_:2},1032,["onClick"]),l(u,{size:"small",type:"success",onClick:c=>gl(t)},{default:a(()=>e[51]||(e[51]=[r(" 编辑 ")])),_:2},1032,["onClick"]),l(u,{size:"small",type:"info",onClick:c=>vl(t)},{default:a(()=>e[52]||(e[52]=[r(" 复制 ")])),_:2},1032,["onClick"]),l(u,{size:"small",type:"danger",onClick:c=>Vl(t)},{default:a(()=>e[53]||(e[53]=[r(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ve,V.routes]])]),_:1}),l(X,{label:"出站代理",name:"outbound"},{default:a(()=>[he((p(),U(de,{data:v.value,style:{width:"100%"}},{default:a(()=>[l(s,{prop:"id",label:"代理名称"}),l(s,{prop:"scheme",label:"代理类型"}),l(s,{label:"延迟"},{default:a(({row:t})=>[t.latency!==void 0?(p(),k("span",Zl,E(t.latency),1)):(p(),k("span",et,"-"))]),_:1}),l(s,{label:"操作",width:"250"},{header:a(()=>[l(u,{type:"primary",onClick:e[2]||(e[2]=t=>Oe("outbound")),style:{width:"75%"}},{default:a(()=>e[54]||(e[54]=[r(" 添加出站代理 ")])),_:1})]),default:a(({row:t})=>[l(re,null,{default:a(()=>[l(u,{size:"small",type:"warning",onClick:c=>rl(t),loading:t.testing},{default:a(()=>e[55]||(e[55]=[r(" 测试延迟 ")])),_:2},1032,["onClick","loading"]),l(u,{size:"small",type:"primary",onClick:c=>Te(t,"outbound")},{default:a(()=>e[56]||(e[56]=[r(" 编辑 ")])),_:2},1032,["onClick"]),l(u,{size:"small",type:"danger",onClick:c=>je(t,"outbound")},{default:a(()=>e[57]||(e[57]=[r(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ve,V.outbound]])]),_:1})]),_:1},8,["modelValue"])]),l(W,{modelValue:z.value,"onUpdate:modelValue":e[10]||(e[10]=t=>z.value=t),title:q.value==="add"?"添加用户":"编辑用户",width:"500px"},{footer:a(()=>[B("span",lt,[l(u,{onClick:e[9]||(e[9]=t=>z.value=!1)},{default:a(()=>e[58]||(e[58]=[r("取消")])),_:1}),l(u,{type:"primary",onClick:nl},{default:a(()=>e[59]||(e[59]=[r(" 确定 ")])),_:1})])]),default:a(()=>[l(ue,{ref_key:"userFormRef",ref:oe,model:S,rules:Ye,"label-width":"100px"},{default:a(()=>[l(_,{label:"用户名",prop:"id"},{default:a(()=>[l(I,{modelValue:S.id,"onUpdate:modelValue":e[4]||(e[4]=t=>S.id=t),disabled:q.value==="edit"},null,8,["modelValue","disabled"])]),_:1}),l(_,{label:"邮箱",prop:"email"},{default:a(()=>[l(I,{modelValue:S.email,"onUpdate:modelValue":e[5]||(e[5]=t=>S.email=t)},null,8,["modelValue"])]),_:1}),l(_,{label:"用户组",prop:"userGroupId"},{default:a(()=>[l(we,{modelValue:S.userGroupId,"onUpdate:modelValue":e[6]||(e[6]=t=>S.userGroupId=t),placeholder:"请选择用户组"},{default:a(()=>[(p(!0),k(le,null,te(x.value,t=>(p(),U(H,{key:t.id,label:t.id,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),q.value==="add"?(p(),U(_,{key:0,label:"密码",prop:"password"},{default:a(()=>[l(I,{modelValue:S.password,"onUpdate:modelValue":e[7]||(e[7]=t=>S.password=t),type:"password","show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})):ie("",!0),l(_,{label:"状态",prop:"enabled"},{default:a(()=>[l(F,{modelValue:S.enabled,"onUpdate:modelValue":e[8]||(e[8]=t=>S.enabled=t),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(W,{modelValue:N.value,"onUpdate:modelValue":e[15]||(e[15]=t=>N.value=t),title:A.value==="add"?"添加代理":"编辑代理",width:"500px"},{footer:a(()=>[B("span",at,[l(u,{onClick:e[14]||(e[14]=t=>N.value=!1)},{default:a(()=>e[60]||(e[60]=[r("取消")])),_:1}),l(u,{type:"primary",onClick:pl},{default:a(()=>e[61]||(e[61]=[r(" 确定 ")])),_:1})])]),default:a(()=>[A.value==="add"?(p(),U(ze,{key:0,modelValue:m.value,"onUpdate:modelValue":e[11]||(e[11]=t=>m.value=t)},{default:a(()=>[l(X,{label:"JSON导入",name:"json"})]),_:1},8,["modelValue"])):ie("",!0),m.value==="json"||A.value==="edit"?(p(),k("div",tt,[l(ue,{ref_key:"proxyFormRef",ref:me,model:g,rules:Qe},{default:a(()=>[l(_,{label:"名称",prop:"id"},{default:a(()=>[l(I,{modelValue:g.id,"onUpdate:modelValue":e[12]||(e[12]=t=>g.id=t),type:"textarea",rows:1,disabled:A.value==="edit",placeholder:"请输入代理名称"},null,8,["modelValue","disabled"])]),_:1}),l(_,{label:"配置",prop:"config"},{default:a(()=>[l(I,{modelValue:g.config,"onUpdate:modelValue":e[13]||(e[13]=t=>g.config=t),type:"textarea",rows:10,placeholder:"请输入JSON配置",onKeydown:[Le(Je($l,["prevent"]),["tab"]),Le(Je(Gl,["shift","prevent"]),["tab"])]},null,8,["modelValue","onKeydown"])]),_:1})]),_:1},8,["model"])])):ie("",!0)]),_:1},8,["modelValue","title"]),l(W,{modelValue:w.value,"onUpdate:modelValue":e[20]||(e[20]=t=>w.value=t),title:P.value==="add"?"添加用户组":"编辑用户组",width:"500px"},{footer:a(()=>[B("span",ot,[l(u,{onClick:e[19]||(e[19]=t=>w.value=!1)},{default:a(()=>e[62]||(e[62]=[r("取消")])),_:1}),l(u,{type:"primary",onClick:bl},{default:a(()=>e[63]||(e[63]=[r(" 确定 ")])),_:1})])]),default:a(()=>[l(ue,{ref_key:"groupFormRef",ref:O,model:$,rules:Xe,"label-width":"100px"},{default:a(()=>[l(_,{label:"名称",prop:"id"},{default:a(()=>[l(I,{modelValue:$.id,"onUpdate:modelValue":e[16]||(e[16]=t=>$.id=t),disabled:P.value==="edit"},null,8,["modelValue","disabled"])]),_:1}),l(_,{label:"入站代理",prop:"inboundProxyIds"},{default:a(()=>[l(we,{modelValue:$.inboundProxyIds,"onUpdate:modelValue":e[17]||(e[17]=t=>$.inboundProxyIds=t),multiple:"",placeholder:"请选择入站代理"},{default:a(()=>[(p(!0),k(le,null,te(Y.value,t=>(p(),U(H,{key:t.id,label:t.id,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"路由方案",prop:"routeSchemeId"},{default:a(()=>[l(we,{modelValue:$.routeSchemeId,"onUpdate:modelValue":e[18]||(e[18]=t=>$.routeSchemeId=t),placeholder:"请选择路由方案"},{default:a(()=>[(p(!0),k(le,null,te(R.value,t=>(p(),U(H,{key:t.id,label:t.id,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(W,{modelValue:J.value,"onUpdate:modelValue":e[24]||(e[24]=t=>J.value=t),title:be.value==="add"?"添加方案":"编辑方案",width:"500px"},{footer:a(()=>[B("span",nt,[l(u,{onClick:e[23]||(e[23]=t=>J.value=!1)},{default:a(()=>e[64]||(e[64]=[r("取消")])),_:1}),l(u,{type:"primary",onClick:_l},{default:a(()=>e[65]||(e[65]=[r(" 确定 ")])),_:1})])]),default:a(()=>[l(ue,{ref_key:"schemeFormRef",ref:Ie,model:T,rules:qe,"label-width":"100px"},{default:a(()=>[l(_,{label:"方案名称",prop:"id"},{default:a(()=>[l(I,{modelValue:T.id,"onUpdate:modelValue":e[21]||(e[21]=t=>T.id=t),disabled:be.value==="edit"},null,8,["modelValue","disabled"])]),_:1}),l(_,{label:"描述",prop:"description"},{default:a(()=>[l(I,{modelValue:T.description,"onUpdate:modelValue":e[22]||(e[22]=t=>T.description=t),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(W,{modelValue:$e.value,"onUpdate:modelValue":e[25]||(e[25]=t=>$e.value=t),title:((Ae=y.value)==null?void 0:Ae.id)+" - 路由规则",width:"800px"},{default:a(()=>{var t,c;return[B("div",st,[l(u,{type:"primary",onClick:Cl},{default:a(()=>e[66]||(e[66]=[r("添加规则")])),_:1})]),l(de,{data:((c=(t=y.value)==null?void 0:t.rules)==null?void 0:c.sort((D,Z)=>(D.priority||0)-(Z.priority||0)))||[],style:{width:"100%"}},{default:a(()=>[l(s,{type:"index",label:"序号",width:"80"}),l(s,{prop:"name",label:"规则名称"}),l(s,{prop:"type",label:"目的类型"},{default:a(({row:D})=>[l(b,{type:Pl(D.type)},{default:a(()=>[r(E(Il(D.type)),1)]),_:2},1032,["type"])]),_:1}),l(s,{prop:"pattern",label:"匹配模式"}),l(s,{prop:"outbounds",label:"出站代理"},{default:a(({row:D})=>[(p(!0),k(le,null,te(D.outbounds,Z=>(p(),U(b,{key:Z,class:"mx-1",style:{"margin-right":"4px"}},{default:a(()=>[r(E(Z),1)]),_:2},1024))),128))]),_:1}),l(s,{label:"操作",width:"150"},{default:a(({row:D,$index:Z})=>[l(re,null,{default:a(()=>{var Me;return[l(u,{size:"small",type:"primary",onClick:Fe=>xl(D)},{default:a(()=>e[67]||(e[67]=[r(" 编辑 ")])),_:2},1032,["onClick"]),l(u,{size:"small",type:"danger",onClick:Fe=>Sl(D)},{default:a(()=>e[68]||(e[68]=[r(" 删除 ")])),_:2},1032,["onClick"]),l(u,{size:"small",disabled:Z===0,onClick:Fe=>Be(D,"up")},{default:a(()=>e[69]||(e[69]=[r(" ↑ ")])),_:2},1032,["disabled","onClick"]),l(u,{size:"small",disabled:Z===(((Me=y.value)==null?void 0:Me.rules.length)||0)-1,onClick:Fe=>Be(D,"down")},{default:a(()=>e[70]||(e[70]=[r(" ↓ ")])),_:2},1032,["disabled","onClick"])]}),_:2},1024)]),_:1})]),_:1},8,["data"])]}),_:1},8,["modelValue","title"]),l(W,{modelValue:se.value,"onUpdate:modelValue":e[31]||(e[31]=t=>se.value=t),title:Ce.value==="add"?"添加规则":"编辑规则",width:"500px"},{footer:a(()=>[B("span",rt,[l(u,{onClick:e[30]||(e[30]=t=>se.value=!1)},{default:a(()=>e[71]||(e[71]=[r("取消")])),_:1}),l(u,{type:"primary",onClick:Ul},{default:a(()=>e[72]||(e[72]=[r(" 确定 ")])),_:1})])]),default:a(()=>[l(ue,{ref_key:"ruleFormRef",ref:Ge,model:h,rules:Ze,"label-width":"100px"},{default:a(()=>[l(_,{label:"规则名称",prop:"name"},{default:a(()=>[l(I,{modelValue:h.name,"onUpdate:modelValue":e[26]||(e[26]=t=>h.name=t)},null,8,["modelValue"])]),_:1}),l(_,{label:"目的类型",prop:"type"},{default:a(()=>[l(we,{modelValue:h.type,"onUpdate:modelValue":e[27]||(e[27]=t=>h.type=t),placeholder:"请选择目的类型"},{default:a(()=>[l(H,{label:"域名",value:"domain"}),l(H,{label:"IP",value:"ip"}),l(H,{label:"Geosite",value:"geosite"}),l(H,{label:"任何",value:"any"})]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"匹配模式",prop:"pattern"},{default:a(()=>[l(I,{modelValue:h.pattern,"onUpdate:modelValue":e[28]||(e[28]=t=>h.pattern=t)},null,8,["modelValue"])]),_:1}),l(_,{label:"出站代理",prop:"outbounds"},{default:a(()=>[l(we,{modelValue:h.outbounds,"onUpdate:modelValue":e[29]||(e[29]=t=>h.outbounds=t),multiple:"",placeholder:"请选择出站代理"},{default:a(()=>[(p(!0),k(le,null,te(v.value,t=>(p(),U(H,{key:t.id,label:t.id,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(W,{modelValue:Re.value,"onUpdate:modelValue":e[33]||(e[33]=t=>Re.value=t),title:"连接配置",width:"500px"},{default:a(()=>[Q.value?(p(),k("div",dt,[l(I,{readonly:"",rows:10,type:"textarea",modelValue:Q.value,"onUpdate:modelValue":e[32]||(e[32]=t=>Q.value=t)},null,8,["modelValue"]),l(u,{onClick:ul,type:"primary",style:{width:"100%"}},{default:a(()=>e[73]||(e[73]=[r("复制")])),_:1}),Q.value?(p(),k("div",ut,[l(Rl,{src:il(Q.value),fit:"contain",style:{width:"200px",height:"200px"}},null,8,["src"])])):ie("",!0)])):(p(),k("div",it,[l(d,{description:"获取链接失败"})]))]),_:1},8,["modelValue"]),l(W,{modelValue:ye.value,"onUpdate:modelValue":e[37]||(e[37]=t=>ye.value=t),title:"复制路由方案",width:"500px"},{footer:a(()=>[B("span",pt,[l(u,{onClick:e[36]||(e[36]=t=>ye.value=!1)},{default:a(()=>e[74]||(e[74]=[r("取消")])),_:1}),l(u,{type:"primary",onClick:wl},{default:a(()=>e[75]||(e[75]=[r(" 确定 ")])),_:1})])]),default:a(()=>[l(ue,{ref:"copySchemeFormRef",model:L,rules:qe,"label-width":"100px"},{default:a(()=>[l(_,{label:"方案名称",prop:"id"},{default:a(()=>[l(I,{modelValue:L.id,"onUpdate:modelValue":e[34]||(e[34]=t=>L.id=t)},null,8,["modelValue"])]),_:1}),l(_,{label:"描述",prop:"description"},{default:a(()=>[l(I,{modelValue:L.description,"onUpdate:modelValue":e[35]||(e[35]=t=>L.description=t),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),gt=We(ct,[["__scopeId","data-v-56240122"]]);export{gt as default};
//# sourceMappingURL=IntegratedManagement-DAQd3nmc.js.map
